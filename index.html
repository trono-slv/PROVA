<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test di Valutazione SSL - Dott. Salvatore Trono</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --arancione: #f97316;
            --arancione-chiaro: #fb923c;
            --grigio-scuro: #1f1f1f;
            --grigio-medio: #2d2d2d;
            --verde: #22c55e;
            --rosso: #ef4444;
        }

        body {
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        .glass-card {
            background: rgba(31, 31, 31, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(249, 115, 22, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--arancione), var(--arancione-chiaro));
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(249, 115, 22, 0.5);
        }

        .progress-bar {
            transition: width 0.3s ease;
            background: linear-gradient(90deg, var(--arancione), var(--arancione-chiaro));
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes modalIn {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .animate-modal-in {
            animation: modalIn 0.3s ease-out;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .answer-option {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .answer-option:hover {
            transform: translateX(5px);
            border-color: var(--arancione);
        }

        .answer-selected {
            background: rgba(249, 115, 22, 0.2);
            border-color: var(--arancione) !important;
        }

        .answer-correct {
            background: rgba(34, 197, 94, 0.2);
            border-color: var(--verde) !important;
        }

        .answer-wrong {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--rosso) !important;
        }
    </style>
</head>
<body class="text-white min-h-screen">

    <!-- Schermata di Benvenuto -->
    <div id="welcomeScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-card rounded-3xl p-8 md:p-12 max-w-4xl w-full fade-in">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üéì</div>
                <h1 class="text-4xl md:text-5xl font-bold mb-4" style="color: var(--arancione);">
                    Test di Valutazione SSL
                </h1>
                <p class="text-xl text-gray-300 mb-6">
                    Verifica le tue competenze in Sicurezza sul Lavoro
                </p>
                <div class="inline-block px-6 py-3 rounded-full text-sm font-semibold" 
                     style="background: rgba(249, 115, 22, 0.2); color: var(--arancione);">
                    üìö Formazione Professionale SSL
                </div>
            </div>

            <!-- Info Test -->
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="glass-card rounded-xl p-6 text-center">
                    <div class="text-3xl mb-2">üìù</div>
                    <div class="text-2xl font-bold" style="color: var(--arancione);">15</div>
                    <div class="text-gray-400 text-sm">Domande</div>
                </div>
                <div class="glass-card rounded-xl p-6 text-center">
                    <div class="text-3xl mb-2">‚è±Ô∏è</div>
                    <div class="text-2xl font-bold" style="color: var(--arancione);">30 min</div>
                    <div class="text-gray-400 text-sm">Tempo disponibile</div>
                </div>
                <div class="glass-card rounded-xl p-6 text-center">
                    <div class="text-3xl mb-2">‚úÖ</div>
                    <div class="text-2xl font-bold" style="color: var(--arancione);">80%</div>
                    <div class="text-gray-400 text-sm">Soglia superamento</div>
                </div>
            </div>

            <!-- Istruzioni -->
            <div class="glass-card rounded-xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <span>üìã</span>
                    <span>Istruzioni</span>
                </h3>
                <ul class="space-y-3 text-gray-300">
                    <li class="flex items-start gap-2">
                        <span class="text-orange-500">‚Ä¢</span>
                        <span>Rispondi a tutte le 15 domande nel tempo disponibile</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-orange-500">‚Ä¢</span>
                        <span>Ogni domanda ha una sola risposta corretta</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-orange-500">‚Ä¢</span>
                        <span>Puoi navigare tra le domande e modificare le risposte</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-orange-500">‚Ä¢</span>
                        <span>Il test si chiude automaticamente allo scadere del tempo</span>
                    </li>
                </ul>
            </div>

            <!-- Pulsante Inizio -->
            <button onclick="startQuiz()" 
                    class="w-full btn-primary text-white font-bold py-4 px-8 rounded-xl text-lg">
                üöÄ INIZIA IL TEST
            </button>

            <!-- Footer -->
            <div class="text-center mt-8 pt-8 border-t border-gray-700">
                <p class="text-gray-400 text-sm mb-2">
                    <strong style="color: var(--arancione);">Dott. Salvatore Trono</strong> - Formatore ed Esperto SSL
                </p>
                <p class="text-gray-500 text-xs">
                    ¬© 2024 - Materiale protetto da diritto d'autore. Riproduzione vietata senza autorizzazione.
                </p>
            </div>
        </div>
    </div>

    <!-- MODAL LEGALE -->
    <div id="legalModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4" style="background: rgba(0,0,0,0.85); backdrop-filter: blur(4px);">
        <div class="animate-modal-in max-w-2xl w-full rounded-2xl p-8 relative" 
             style="background: linear-gradient(135deg, rgba(31,31,31,0.95), rgba(23,23,23,0.98)); 
                    border: 2px solid var(--arancione); 
                    box-shadow: 0 25px 50px -12px rgba(249,115,22,0.4);">
            
            <!-- Titolo -->
            <div class="text-center mb-6">
                <div class="text-5xl mb-3">‚ö†Ô∏è</div>
                <h2 class="text-3xl font-bold mb-2" style="color: var(--arancione);">ATTENZIONE</h2>
                <div class="h-1 w-32 mx-auto rounded-full" style="background: var(--arancione);"></div>
            </div>

            <!-- Contenuto -->
            <div class="space-y-5 text-gray-300 text-base leading-relaxed">
                <p class="font-semibold text-white">Confermo di aver letto e compreso:</p>
                
                <ul class="space-y-3 pl-2">
                    <li class="flex items-start gap-2">
                        <span class="text-xl flex-shrink-0">‚Ä¢</span>
                        <span>√à <strong class="text-white">vietato usare il materiale per scopi privati</strong></span>
                    </li>
                </ul>

                <!-- BOX LEGALE ROSSO -->
                <div class="bg-red-950 border-2 border-red-600 rounded-xl p-5 space-y-4">
                    <div class="flex items-center gap-2 text-red-400 font-bold text-lg">
                        <span class="text-2xl">‚öñÔ∏è</span>
                        <span>TUTELA LEGALE</span>
                    </div>
                    
                    <p class="text-gray-200 text-sm leading-relaxed">
                        Il presente materiale √® protetto da:
                    </p>
                    
                    <ul class="space-y-2 text-sm text-gray-200">
                        <li class="flex items-start gap-2">
                            <span>üìú</span>
                            <span><strong>Legge 633/1941</strong> (Diritto d'Autore) - Art. 171</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span>üõ°Ô∏è</span>
                            <span><strong>D.Lgs 231/2001</strong> (Responsabilit√† Amministrativa)</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span>‚öñÔ∏è</span>
                            <span><strong>Codice Penale</strong> - Art. 615-ter (Accesso Abusivo)</span>
                        </li>
                    </ul>
                    
                    <div class="bg-red-900 rounded-lg p-3 mt-3">
                        <p class="text-red-200 text-xs font-semibold">
                            ‚ö†Ô∏è La violazione comporta: <strong>Sanzioni pecuniarie</strong> fino a ‚Ç¨15.493 e/o <strong>reclusione</strong> fino a 3 anni
                        </p>
                    </div>
                </div>

                <!-- DISCLAIMER -->
                <div class="bg-gray-800 border border-gray-600 rounded-xl p-4">
                    <p class="text-xs text-gray-400 leading-relaxed">
                        <strong class="text-gray-300">DISCLAIMER:</strong> Questo test √® uno strumento formativo. 
                        I risultati non costituiscono certificazione ufficiale. Per attestati validi ai sensi del D.Lgs 81/08, 
                        contattare enti accreditati.
                    </p>
                </div>
            </div>

            <!-- Pulsanti -->
            <div class="flex gap-4 mt-8">
                <button onclick="closeLegalModal()" 
                        class="flex-1 px-8 py-4 rounded-xl font-bold text-lg transition-all duration-300 border-2"
                        style="background: var(--grigio-scuro); border-color: #fff; color: #fff;"
                        onmouseover="this.style.background='var(--rosso)'; this.style.borderColor='var(--rosso)';"
                        onmouseout="this.style.background='var(--grigio-scuro)'; this.style.borderColor='#fff';">
                    ‚ùå ANNULLA
                </button>
                <button onclick="acceptLegal()" 
                        class="flex-1 px-8 py-4 rounded-xl font-bold text-lg text-white transition-all duration-300"
                        style="background: linear-gradient(135deg, var(--arancione), var(--arancione-chiaro)); 
                               box-shadow: 0 10px 25px -5px rgba(249,115,22,0.5);"
                        onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 15px 35px -5px rgba(249,115,22,0.7)';"
                        onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 10px 25px -5px rgba(249,115,22,0.5)';">
                    ‚úÖ ACCETTO E PROSEGUO
                </button>
            </div>
        </div>
    </div>

    <!-- Schermata Quiz (nascosta inizialmente) -->
    <div id="quizScreen" class="hidden min-h-screen p-4 md:p-8">
        <!-- Header Quiz -->
        <div class="max-w-5xl mx-auto mb-6">
            <div class="glass-card rounded-2xl p-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <!-- Timer -->
                    <div class="flex items-center gap-3">
                        <div class="text-3xl">‚è±Ô∏è</div>
                        <div>
                            <div class="text-sm text-gray-400">Tempo rimanente</div>
                            <div id="timer" class="text-2xl font-bold" style="color: var(--arancione);">30:00</div>
                        </div>
                    </div>

                    <!-- Progress -->
                    <div class="flex-1 max-w-md">
                        <div class="flex justify-between text-sm text-gray-400 mb-2">
                            <span>Progresso</span>
                            <span id="progressText">0/15</span>
                        </div>
                        <div class="h-3 bg-gray-700 rounded-full overflow-hidden">
                            <div id="progressBar" class="progress-bar h-full" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Score -->
                    <div class="flex items-center gap-3">
                        <div class="text-3xl">üéØ</div>
                        <div>
                            <div class="text-sm text-gray-400">Risposte date</div>
                            <div id="answeredCount" class="text-2xl font-bold" style="color: var(--arancione);">0/15</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Domanda -->
        <div class="max-w-5xl mx-auto">
            <div class="glass-card rounded-2xl p-8 mb-6 fade-in">
                <div class="mb-6">
                    <div class="text-sm text-gray-400 mb-2">
                        Domanda <span id="questionNumber">1</span> di 15
                    </div>
                    <h2 id="questionText" class="text-2xl font-bold text-white leading-relaxed"></h2>
                </div>

                <!-- Opzioni di risposta -->
                <div id="answersContainer" class="space-y-4"></div>
            </div>

            <!-- Navigazione -->
            <div class="flex justify-between gap-4">
                <button id="prevBtn" onclick="previousQuestion()" 
                        class="glass-card px-6 py-3 rounded-xl font-semibold hover:border-orange-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    ‚Üê Precedente
                </button>
                
                <button id="nextBtn" onclick="nextQuestion()" 
                        class="glass-card px-6 py-3 rounded-xl font-semibold hover:border-orange-500 transition-all">
                    Successiva ‚Üí
                </button>
                
                <button id="submitBtn" onclick="submitQuiz()" 
                        class="hidden btn-primary px-8 py-3 rounded-xl font-bold text-white">
                    üìä TERMINA TEST
                </button>
            </div>

            <!-- Mappa domande -->
            <div class="glass-card rounded-2xl p-6 mt-6">
                <h3 class="text-lg font-bold mb-4">Mappa domande</h3>
                <div id="questionMap" class="grid grid-cols-5 md:grid-cols-10 gap-3"></div>
                <div class="flex gap-6 mt-4 text-sm text-gray-400">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-gray-700"></div>
                        <span>Non risposta</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded" style="background: var(--arancione);"></div>
                        <span>Risposta data</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Schermata Risultati (nascosta inizialmente) -->
    <div id="resultsScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="glass-card rounded-3xl p-8 md:p-12 max-w-4xl w-full fade-in">
            <!-- Risultato Finale -->
            <div class="text-center mb-8">
                <div id="resultEmoji" class="text-8xl mb-4">üéâ</div>
                <h2 id="resultTitle" class="text-4xl font-bold mb-4" style="color: var(--arancione);">
                    Test Completato!
                </h2>
                <div id="resultScore" class="text-6xl font-bold mb-4">0/15</div>
                <div id="resultPercentage" class="text-2xl text-gray-300 mb-4">0%</div>
                <div id="resultMessage" class="text-xl text-gray-400"></div>
            </div>

            <!-- Statistiche -->
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="glass-card rounded-xl p-6 text-center">
                    <div class="text-3xl mb-2">‚úÖ</div>
                    <div id="correctAnswers" class="text-3xl font-bold" style="color: var(--verde);">0</div>
                    <div class="text-gray-400 text-sm">Corrette</div>
                </div>
                <div class="glass-card rounded-xl p-6 text-center">
                    <div class="text-3xl mb-2">‚ùå</div>
                    <div id="wrongAnswers" class="text-3xl font-bold" style="color: var(--rosso);">0</div>
                    <div class="text-gray-400 text-sm">Errate</div>
                </div>
                <div class="glass-card rounded-xl p-6 text-center">
                    <div class="text-3xl mb-2">‚è±Ô∏è</div>
                    <div id="timeUsed" class="text-3xl font-bold" style="color: var(--arancione);">0:00</div>
                    <div class="text-gray-400 text-sm">Tempo impiegato</div>
                </div>
            </div>

            <!-- Riepilogo dettagliato -->
            <div class="glass-card rounded-xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-4">üìã Riepilogo dettagliato</h3>
                <div id="detailedResults" class="space-y-4 max-h-96 overflow-y-auto"></div>
            </div>

            <!-- Azioni -->
            <div class="flex gap-4">
                <button onclick="restartQuiz()" 
                        class="flex-1 glass-card px-6 py-4 rounded-xl font-bold hover:border-orange-500 transition-all">
                    üîÑ RICOMINCIA
                </button>
                <button onclick="exportResults()" 
                        class="flex-1 btn-primary px-6 py-4 rounded-xl font-bold text-white">
                    üìÑ ESPORTA PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        // Database domande
        const questionDatabase = [
            {
                question: "Chi √® il responsabile del Servizio di Prevenzione e Protezione (RSPP)?",
                answers: [
                    "Una figura designata dal datore di lavoro",
                    "Un dipendente qualsiasi dell'azienda",
                    "Il medico competente",
                    "Un rappresentante dei lavoratori"
                ],
                correct: 0
            },
            {
                question: "Qual √® l'obiettivo principale del D.Lgs 81/08?",
                answers: [
                    "Aumentare la produttivit√†",
                    "Tutelare la salute e sicurezza dei lavoratori",
                    "Ridurre i costi aziendali",
                    "Incrementare il personale"
                ],
                correct: 1
            },
            {
                question: "Cosa si intende per DPI?",
                answers: [
                    "Dispositivi di Produzione Industriale",
                    "Dispositivi di Protezione Individuale",
                    "Documenti di Prevenzione Incendi",
                    "Direttive di Protezione Interna"
                ],
                correct: 1
            },
            {
                question: "Ogni quanto deve essere aggiornato il Documento di Valutazione dei Rischi (DVR)?",
                answers: [
                    "Ogni 5 anni",
                    "Solo alla fondazione dell'azienda",
                    "In caso di modifiche significative",
                    "Mensilmente"
                ],
                correct: 2
            },
            {
                question: "Chi pu√≤ svolgere il ruolo di Rappresentante dei Lavoratori per la Sicurezza (RLS)?",
                answers: [
                    "Solo il datore di lavoro",
                    "Un lavoratore eletto o designato",
                    "Il medico competente",
                    "Un consulente esterno"
                ],
                correct: 1
            },
            {
                question: "Qual √® la frequenza minima di formazione obbligatoria per i lavoratori?",
                answers: [
                    "Ogni anno",
                    "Ogni 5 anni",
                    "All'assunzione e quando necessario",
                    "Mai, se gi√† formati"
                ],
                correct: 2
            },
            {
                question: "Cosa deve contenere il Piano di Emergenza?",
                answers: [
                    "Solo i numeri di emergenza",
                    "Procedure, vie di fuga, punti di raccolta",
                    "L'organigramma aziendale",
                    "Il bilancio di sicurezza"
                ],
                correct: 1
            },
            {
                question: "Qual √® il limite di rumore per l'esposizione quotidiana senza protezioni?",
                answers: [
                    "80 dB(A)",
                    "85 dB(A)",
                    "90 dB(A)",
                    "95 dB(A)"
                ],
                correct: 1
            },
            {
                question: "Chi ha l'obbligo di fornire i DPI ai lavoratori?",
                answers: [
                    "I lavoratori stessi",
                    "Il datore di lavoro",
                    "Il medico competente",
                    "Il RLS"
                ],
                correct: 1
            },
            {
                question: "Cosa indica la segnaletica di colore rosso?",
                answers: [
                    "Obbligo",
                    "Pericolo o divieto",
                    "Salvataggio",
                    "Avvertimento"
                ],
                correct: 1
            },
            {
                question: "Quale documento certifica l'idoneit√† alla mansione del lavoratore?",
                answers: [
                    "Il DVR",
                    "Il certificato medico del medico competente",
                    "L'attestato di formazione",
                    "Il contratto di lavoro"
                ],
                correct: 1
            },
            {
                question: "Ogni quanto deve essere effettuata la sorveglianza sanitaria?",
                answers: [
                    "Secondo protocolli stabiliti dal medico competente",
                    "Ogni 10 anni",
                    "Solo in caso di malattia",
                    "Mai, se il lavoratore √® sano"
                ],
                correct: 0
            },
            {
                question: "Cos'√® il near miss?",
                answers: [
                    "Un infortunio grave",
                    "Un mancato infortunio",
                    "Una violazione normativa",
                    "Un dispositivo di sicurezza"
                ],
                correct: 1
            },
            {
                question: "Quale organo vigila sull'applicazione delle norme di sicurezza?",
                answers: [
                    "L'azienda stessa",
                    "L'Ispettorato del Lavoro",
                    "I sindacati",
                    "Il medico di base"
                ],
                correct: 1
            },
            {
                question: "Cosa si intende per rischio ergonomico?",
                answers: [
                    "Rischio legato a posture e movimenti",
                    "Rischio chimico",
                    "Rischio elettrico",
                    "Rischio biologico"
                ],
                correct: 0
            },
            {
                question: "Chi pu√≤ interrompere l'attivit√† lavorativa in caso di pericolo grave e immediato?",
                answers: [
                    "Solo il datore di lavoro",
                    "Il lavoratore stesso",
                    "Solo il RLS",
                    "Nessuno, il lavoro deve continuare"
                ],
                correct: 1
            },
            {
                question: "Qual √® la durata minima del corso di formazione generale per i lavoratori?",
                answers: [
                    "2 ore",
                    "4 ore",
                    "8 ore",
                    "16 ore"
                ],
                correct: 1
            },
            {
                question: "Cosa indica un cartello di forma rotonda con bordo rosso?",
                answers: [
                    "Obbligo",
                    "Divieto",
                    "Avvertimento",
                    "Salvataggio"
                ],
                correct: 1
            },
            {
                question: "Qual √® il primo intervento in caso di incendio?",
                answers: [
                    "Chiamare i vigili del fuoco",
                    "Attivare l'allarme e tentare lo spegnimento se possibile",
                    "Evacuare immediatamente",
                    "Filmare l'evento"
                ],
                correct: 1
            },
            {
                question: "Cosa si intende per agenti cancerogeni?",
                answers: [
                    "Sostanze che possono causare il cancro",
                    "Agenti atmosferici",
                    "Sostanze allergeniche",
                    "Agenti biologici generici"
                ],
                correct: 0
            }
        ];

        // Variabili globali
        let questions = [];
        let currentQuestion = 0;
        let userAnswers = [];
        let score = 0;
        let timeLeft = 30 * 60; // 30 minuti in secondi
        let timerInterval;
        let startTime;

        // Funzione per ottenere domande casuali
        function getRandomQuestions(num) {
            const shuffled = [...questionDatabase].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, num);
        }

        // Funzione per iniziare il quiz
        function startQuiz() {
            document.getElementById('legalModal').classList.remove('hidden');
        }

        function closeLegalModal() {
            document.getElementById('legalModal').classList.add('hidden');
        }

        function acceptLegal() {
            document.getElementById('legalModal').classList.add('hidden');
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('quizScreen').classList.remove('hidden');
            
            questions = getRandomQuestions(15);
            currentQuestion = 0;
            userAnswers = new Array(questions.length).fill(null);
            score = 0;
            timeLeft = 30 * 60;
            startTime = Date.now();
            
            renderQuestion();
            updateQuestionMap();
            startTimer();
        }

        // Timer
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timer').textContent = display;
            
            // Cambio colore se < 5 minuti
            if (timeLeft < 300) {
                document.getElementById('timer').style.color = 'var(--rosso)';
            }
        }

        // Renderizza domanda
        function renderQuestion() {
            const q = questions[currentQuestion];
            
            document.getElementById('questionNumber').textContent = currentQuestion + 1;
            document.getElementById('questionText').textContent = q.question;
            
            const container = document.getElementById('answersContainer');
            container.innerHTML = '';
            
            q.answers.forEach((answer, index) => {
                const div = document.createElement('div');
                div.className = `answer-option glass-card rounded-xl p-4 border-2 border-gray-700 ${
                    userAnswers[currentQuestion] === index ? 'answer-selected' : ''
                }`;
                div.innerHTML = `
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="radio" 
                               name="answer" 
                               value="${index}" 
                               ${userAnswers[currentQuestion] === index ? 'checked' : ''}
                               onchange="selectAnswer(${index})"
                               class="w-5 h-5">
                        <span class="flex-1">${answer}</span>
                    </label>
                `;
                container.appendChild(div);
            });
            
            updateProgress();
            updateNavButtons();
        }

        function selectAnswer(index) {
            userAnswers[currentQuestion] = index;
            updateQuestionMap();
            renderQuestion();
        }

        function updateProgress() {
            const answered = userAnswers.filter(a => a !== null).length;
            const percentage = (answered / questions.length) * 100;
            
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${answered}/${questions.length}`;
            document.getElementById('answeredCount').textContent = `${answered}/${questions.length}`;
        }

        function updateQuestionMap() {
            const container = document.getElementById('questionMap');
            container.innerHTML = '';
            
            questions.forEach((_, index) => {
                const btn = document.createElement('button');
                btn.textContent = index + 1;
                btn.className = `w-10 h-10 rounded-lg font-bold transition-all ${
                    userAnswers[index] !== null 
                        ? 'text-white' 
                        : 'bg-gray-700 text-gray-400'
                }`;
                
                if (userAnswers[index] !== null) {
                    btn.style.background = 'var(--arancione)';
                }
                
                if (index === currentQuestion) {
                    btn.style.border = '2px solid white';
                }
                
                btn.onclick = () => {
                    currentQuestion = index;
                    renderQuestion();
                    updateQuestionMap();
                };
                
                container.appendChild(btn);
            });
        }

        function updateNavButtons() {
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            
            if (currentQuestion === questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('submitBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('submitBtn').classList.add('hidden');
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
                updateQuestionMap();
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                renderQuestion();
                updateQuestionMap();
            }
        }

        function submitQuiz() {
            clearInterval(timerInterval);
            
            // Calcola punteggio
            score = 0;
            questions.forEach((q, index) => {
                if (userAnswers[index] === q.correct) {
                    score++;
                }
            });
            
            const percentage = Math.round((score / questions.length) * 100);
            const timeUsed = Math.floor((Date.now() - startTime) / 1000);
            const minutesUsed = Math.floor(timeUsed / 60);
            const secondsUsed = timeUsed % 60;
            
            // Mostra risultati
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            // Emoji e messaggio basati sul risultato
            let emoji, title, message;
            if (percentage >= 80) {
                emoji = 'üéâ';
                title = 'COMPLIMENTI!';
                message = 'Hai superato il test con successo!';
            } else if (percentage >= 60) {
                emoji = 'üòä';
                title = 'BUON RISULTATO';
                message = 'Hai una buona preparazione, ma puoi migliorare.';
            } else {
                emoji = 'üìö';
                title = 'DA RIVEDERE';
                message = 'Ti consigliamo di ripassare gli argomenti e riprovare.';
            }
            
            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultScore').textContent = `${score}/${questions.length}`;
            document.getElementById('resultPercentage').textContent = `${percentage}%`;
            document.getElementById('resultMessage').textContent = message;
            
            document.getElementById('correctAnswers').textContent = score;
            document.getElementById('wrongAnswers').textContent = questions.length - score;
            document.getElementById('timeUsed').textContent = `${minutesUsed}:${secondsUsed.toString().padStart(2, '0')}`;
            
            // Riepilogo dettagliato
            const detailedContainer = document.getElementById('detailedResults');
            detailedContainer.innerHTML = '';
            
            questions.forEach((q, index) => {
                const isCorrect = userAnswers[index] === q.correct;
                const div = document.createElement('div');
                div.className = `glass-card rounded-xl p-4 border-2 ${
                    isCorrect ? 'border-green-500' : 'border-red-500'
                }`;
                div.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="text-2xl">${isCorrect ? '‚úÖ' : '‚ùå'}</div>
                        <div class="flex-1">
                            <div class="font-bold mb-2">Domanda ${index + 1}</div>
                            <div class="text-gray-300 mb-2">${q.question}</div>
                            ${!isCorrect ? `
                                <div class="text-sm">
                                    <div class="text-red-400">La tua risposta: ${q.answers[userAnswers[index]] || 'Nessuna risposta'}</div>
                                    <div class="text-green-400">Risposta corretta: ${q.answers[q.correct]}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                detailedContainer.appendChild(div);
            });
        }

        function restartQuiz() {
            location.reload();
        }

        function exportResults() {
            // Funzionalit√† di esportazione (da implementare con jsPDF o html2canvas)
            alert('Funzione di esportazione in sviluppo!');
        }
    </script>
</body>
</html>
